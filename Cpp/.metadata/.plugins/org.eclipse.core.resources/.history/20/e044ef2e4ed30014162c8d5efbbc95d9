/*
 * GamePlay.cpp
 *
 *  Created on: Mar 25, 2015
 *      Author: vitor
 */

#include "GamePlay.h"

#include <iostream>

#include <assert.h>

#include "SDL_image.h"

using namespace std;

// TODO: remove this.
Spritesheet *create_spritesheet(SDL_Renderer *renderer)
{
	Spritesheet *sheet = new Spritesheet();
	SDL_Texture *texture = loadTexture("images/leaping_frog_atlas.png", renderer);

	// Load sheet image file.
	sheet->setTexture(texture);

	// Register sprites.
	sheet->add("button_play.png",
			{191, 2, 259, 114},
			false,
			true,
			{3, 3, 59, 114},
			{265, 120},
			{0.5, 0.5});

	sheet->add("frog_blue_leaping_0000.png",
		{2,193,48,32},
		false,
		false,
		{0,0,48,32},
		{48,32},
		{0.5,0.5});

	sheet->add("frog_blue_leaping_0001.png",
		{303,118,50,41},
		true,
		false,
		{0,0,50,41},
		{50,41},
		{0.5,0.5});

	sheet->add("frog_blue_leaping_0002.png",
		{251,118,50,57},
		false,
		false,
		{0,0,50,57},
		{50,57},
		{0.5,0.5});

	sheet->add("frog_blue_leaping_0003.png",
		{329,170,50,41},
		true,
		false,
		{0,0,50,41},
		{50,41},
		{0.5,0.5});


		sheet->add("frog_blue_standing_0000.png",
		{52,193,48,32},
		false,
		false,
		{0,0,48,32},
		{48,32},
		{0.5,0.5});

		sheet->add("frog_blue_standing_0001.png",
		{102,193,48,32},
		false,
		false,
		{0,0,48,32},
		{48,32},
		{0.5,0.5});

		sheet->add("frog_blue_standing_0002.png",
		{152,193,48,32},
		false,
		false,
		{0,0,48,32},
		{48,32},
		{0.5,0.5});

	//sheet->dump();

	/*
	std::string filename;
	SDL_Rect frame;
	bool rotated;
	bool trimmed;
	SDL_Rect sprite_source_size;
	SDL_Rect source_size;
	SDL_Rect pivot;
	*/

	return sheet;
}

GamePlay::GamePlay()
{
	initResources();
}

GamePlay::~GamePlay()
{
	finalizeResources();
}

void GamePlay::initResources(void)
{
	if( SDL_Init( SDL_INIT_VIDEO ) < 0 )
	{
		cout << "SDL could not initialize! SDL_Error: " << SDL_GetError() << endl;
		assert(0);
	}


	if( !(IMG_Init( IMG_INIT_PNG ) & IMG_INIT_PNG ) )
	{
		cout << "SDL_image could not initialize! SDL_image Error: " << IMG_GetError() << endl;
		assert(0);
	}

	screen = new GameVideo();
	atlas = new GameAtlas();

	// Fill atlas.
	atlas->addSheet( create_spritesheet(screen->renderer()) );
}


void GamePlay::finalizeResources(void)
{
	// Free resources.
	free(atlas);
	free(screen);

	// Quit SDL subsystems.
	IMG_Quit();
	SDL_Quit();
}

void GamePlay::loop(void)
{

}
